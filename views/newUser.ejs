<%- include('partials/header.ejs'); -%>
    <link rel="stylesheet" href="/styles/new.css">

    <div class="new-user-container">
        <div class="box">
            <div id="heading">
                <% if (locals.userToEdit) { %>
                    <h1>Edit Family Member</h1>
                    <% } else { %>
                        <h1>Add New Family Member</h1>
                        <% } %>
            </div>


            <form action="/createUser" method="post" class="new-user-form">
                <input type="hidden" name="userId" value="<%= locals.userToEdit ? userToEdit.user_id : '' %>" />
                <div class="input-group">
                    <input type="text" name="username" placeholder="Enter name" required />
                </div>

                <div class="color-selection">
                    <h3>Choose Your Theme Color</h3>
                    <div class="color-options">
                        <label class="color-option">
                            <input type="radio" name="color" value="purple-blue">
                            <div class="color-preview purple-blue">
                                <div class="color-primary"></div>
                                <div class="color-secondary"></div>
                            </div>
                            <span>Purple Blue</span>
                        </label>

                        <label class="color-option">
                            <input type="radio" name="color" value="blue">
                            <div class="color-preview blue">
                                <div class="color-primary"></div>
                                <div class="color-secondary"></div>
                            </div>
                            <span>Blue</span>
                        </label>

                        <label class="color-option">
                            <input type="radio" name="color" value="teal">
                            <div class="color-preview teal">
                                <div class="color-primary"></div>
                                <div class="color-secondary"></div>
                            </div>
                            <span>Teal</span>
                        </label>

                        <label class="color-option">
                            <input type="radio" name="color" value="coral">
                            <div class="color-preview coral">
                                <div class="color-primary"></div>
                                <div class="color-secondary"></div>
                            </div>
                            <span>Coral</span>
                        </label>

                        <label class="color-option">
                            <input type="radio" name="color" value="green">
                            <div class="color-preview green">
                                <div class="color-primary"></div>
                                <div class="color-secondary"></div>
                            </div>
                            <span>Green</span>
                        </label>

                        <label class="color-option">
                            <input type="radio" name="color" value="orange">
                            <div class="color-preview orange">
                                <div class="color-primary"></div>
                                <div class="color-secondary"></div>
                            </div>
                            <span>Orange</span>
                        </label>

                        <label class="color-option">
                            <input type="radio" name="color" value="red">
                            <div class="color-preview red">
                                <div class="color-primary"></div>
                                <div class="color-secondary"></div>
                            </div>
                            <span>Red</span>
                        </label>

                        <label class="color-option">
                            <input type="radio" name="color" value="pink">
                            <div class="color-preview pink">
                                <div class="color-primary"></div>
                                <div class="color-secondary"></div>
                            </div>
                            <span>Pink</span>
                        </label>

                        <label class="color-option">
                            <input type="radio" name="color" value="indigo">
                            <div class="color-preview indigo">
                                <div class="color-primary"></div>
                                <div class="color-secondary"></div>
                            </div>
                            <span>Indigo</span>
                        </label>

                        <label class="color-option">
                            <input type="radio" name="color" value="cyan">
                            <div class="color-preview cyan">
                                <div class="color-primary"></div>
                                <div class="color-secondary"></div>
                            </div>
                            <span>Cyan</span>
                        </label>

                        <label class="color-option">
                            <input type="radio" name="color" value="lime">
                            <div class="color-preview lime">
                                <div class="color-primary"></div>
                                <div class="color-secondary"></div>
                            </div>
                            <span>Lime</span>
                        </label>

                        <label class="color-option">
                            <input type="radio" name="color" value="amber">
                            <div class="color-preview amber">
                                <div class="color-primary"></div>
                                <div class="color-secondary"></div>
                            </div>
                            <span>Amber</span>
                        </label>

                        <label class="color-option">
                            <input type="radio" name="color" value="deep-orange">
                            <div class="color-preview deep-orange">
                                <div class="color-primary"></div>
                                <div class="color-secondary"></div>
                            </div>
                            <span>Deep Orange</span>
                        </label>

                        <label class="color-option">
                            <input type="radio" name="color" value="brown">
                            <div class="color-preview brown">
                                <div class="color-primary"></div>
                                <div class="color-secondary"></div>
                            </div>
                            <span>Brown</span>
                        </label>
                    </div>
                </div>

                <div class="button-group">
                    <% if (locals.userToEdit) { %>
                        <button type="submit" class="btn-primary" name="action" value="update">Update Member</button>
                        <% } else { %>
                            <button type="submit" class="btn-primary" name="action" value="create">Create
                                Member</button>
                            <% } %>
                                <button type="button" class="btn-secondary"
                                    onclick="window.location.href='/'">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let userToEdit = JSON.stringify(<%- JSON.stringify(locals.userToEdit || null) %>);
        let userAlreadyExists = JSON.stringify(<%- JSON.stringify(locals.userAlreadyExists || null) %>);

        let username = document.querySelector('input[name="username"]');

        console.log(userToEdit);
        console.log(userAlreadyExists);

        if (userAlreadyExists != "null") {
            username.setAttribute("placeholder", JSON.parse(userAlreadyExists));
        } else if (userToEdit != "null" && userAlreadyExists == "null") {
            username.setAttribute("value", JSON.parse(userToEdit).name);

            // Présélectionner la couleur de l'utilisateur
            const colorInput = document.querySelector(`input[name="color"][value="${JSON.parse(userToEdit).color}"]`);
            if (colorInput) {
                colorInput.checked = true;
            }
        }
    </script>

    <%- include('partials/footer.ejs'); -%>